<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>canvas的艺术 | Sansen Sekai</title>
    <meta name="description" content="三千世界, 学无止境">
    <link rel="shortcut icon" type="image/x-icon" href="./public/sad-me.png">
    
    <link rel="preload" href="/assets/css/0.styles.56fe4379.css" as="style"><link rel="preload" href="/assets/js/app.3b644823.js" as="script"><link rel="preload" href="/assets/js/2.e997199f.js" as="script"><link rel="preload" href="/assets/js/34.89e76bff.js" as="script"><link rel="prefetch" href="/assets/js/10.5ee0a82c.js"><link rel="prefetch" href="/assets/js/11.daee2873.js"><link rel="prefetch" href="/assets/js/12.8248456d.js"><link rel="prefetch" href="/assets/js/13.54a5dd4a.js"><link rel="prefetch" href="/assets/js/14.b823f735.js"><link rel="prefetch" href="/assets/js/15.d3b5d7cb.js"><link rel="prefetch" href="/assets/js/16.be4ba155.js"><link rel="prefetch" href="/assets/js/17.c61f081b.js"><link rel="prefetch" href="/assets/js/18.27973658.js"><link rel="prefetch" href="/assets/js/19.12894926.js"><link rel="prefetch" href="/assets/js/20.b2251d91.js"><link rel="prefetch" href="/assets/js/21.9368ff97.js"><link rel="prefetch" href="/assets/js/22.c5dd3b56.js"><link rel="prefetch" href="/assets/js/23.823a011e.js"><link rel="prefetch" href="/assets/js/24.133dc402.js"><link rel="prefetch" href="/assets/js/25.908d76af.js"><link rel="prefetch" href="/assets/js/26.50ae55c2.js"><link rel="prefetch" href="/assets/js/27.4d3bdc40.js"><link rel="prefetch" href="/assets/js/28.1910ec53.js"><link rel="prefetch" href="/assets/js/29.ae3971d2.js"><link rel="prefetch" href="/assets/js/3.8119daf4.js"><link rel="prefetch" href="/assets/js/30.a266a056.js"><link rel="prefetch" href="/assets/js/31.6e1332a3.js"><link rel="prefetch" href="/assets/js/32.d43f6148.js"><link rel="prefetch" href="/assets/js/33.9f60066d.js"><link rel="prefetch" href="/assets/js/35.976d89b0.js"><link rel="prefetch" href="/assets/js/36.70cb64a6.js"><link rel="prefetch" href="/assets/js/37.5a73ef0e.js"><link rel="prefetch" href="/assets/js/38.c74c2711.js"><link rel="prefetch" href="/assets/js/39.8e716e3c.js"><link rel="prefetch" href="/assets/js/4.5292c871.js"><link rel="prefetch" href="/assets/js/40.64191991.js"><link rel="prefetch" href="/assets/js/41.118c8402.js"><link rel="prefetch" href="/assets/js/42.7c764675.js"><link rel="prefetch" href="/assets/js/43.6cade1e6.js"><link rel="prefetch" href="/assets/js/44.615aeebf.js"><link rel="prefetch" href="/assets/js/45.acfd3be9.js"><link rel="prefetch" href="/assets/js/46.5e409128.js"><link rel="prefetch" href="/assets/js/5.69e3b9fc.js"><link rel="prefetch" href="/assets/js/6.36a28e4b.js"><link rel="prefetch" href="/assets/js/7.708932b7.js"><link rel="prefetch" href="/assets/js/8.288108ab.js"><link rel="prefetch" href="/assets/js/9.377be857.js">
    <link rel="stylesheet" href="/assets/css/0.styles.56fe4379.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Sansen Sekai</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/essay/" class="nav-link router-link-active">技术杂文</a></div><div class="nav-item"><a href="/base/" class="nav-link">基础知识</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法解析</a></div><div class="nav-item"><a href="https://github.com/sad-xu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/essay/" class="nav-link router-link-active">技术杂文</a></div><div class="nav-item"><a href="/base/" class="nav-link">基础知识</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法解析</a></div><div class="nav-item"><a href="https://github.com/sad-xu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/essay/" class="sidebar-link">技术杂文</a></li><li><a href="/essay/canvas的艺术.html" class="active sidebar-link">canvas的艺术</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/essay/纯CSS实现酷炫文字效果.html" class="sidebar-link">纯CSS实现酷炫文字效果</a></li><li><a href="/essay/Highcharts多图联动实现及优化.html" class="sidebar-link">Highcharts多图联动实现及优化</a></li><li><a href="/essay/导出图片和excel实践.html" class="sidebar-link">导出图片和Excel实践</a></li><li><a href="/essay/Highcharts矩形树图的自定义布局方法.html" class="sidebar-link">Highcharts矩形树图的自定义布局方法</a></li><li><a href="/essay/第一届缤纷-滨江前端技术沙龙总结与感想.html" class="sidebar-link">第一届缤纷-滨江前端技术沙龙总结与感想</a></li><li><a href="/essay/前端代码埋点实践（二）.html" class="sidebar-link">前端代码埋点实践（二）</a></li><li><a href="/essay/前端代码埋点实践.html" class="sidebar-link">前端代码埋点实践</a></li><li><a href="/essay/Rust系列（一）.html" class="sidebar-link">Rust系列（一）：从零开始</a></li><li><a href="/essay/Rust系列（二）.html" class="sidebar-link">Rust系列（二）</a></li><li><a href="/essay/初探Rust与WASM.html" class="sidebar-link">初试WASM与Rust</a></li><li><a href="/essay/深度解析异步串行的4种实现及区别.html" class="sidebar-link">深度解析异步串行的4种实现及区别</a></li><li><a href="/essay/SVG图标在项目中的使用.html" class="sidebar-link">SVG图标在项目中的使用</a></li><li><a href="/essay/神策数据前端埋点源码解读.html" class="sidebar-link">神策数据前端埋点源码不完全解读</a></li><li><a href="/essay/vue-cli3移动端项目配置不完全指南.html" class="sidebar-link">vue-cli3移动端项目配置不完全指南</a></li><li><a href="/essay/用js让CPU跑出一个阿姆斯特朗回旋加速喷气式阿姆斯特朗炮.html" class="sidebar-link">用js让CPU跑出一个阿姆斯特朗回旋加速喷气式阿姆斯特朗炮</a></li><li><a href="/essay/Vue组件命令式和声明式的使用方式.html" class="sidebar-link">Vue组件命令式和声明式的使用方式</a></li><li><a href="/essay/优雅灵活的前端权限控制实践.html" class="sidebar-link">优雅灵活的前端权限控制实践</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="canvas的艺术"><a href="#canvas的艺术" class="header-anchor">#</a> canvas的艺术</h1> <p><code>https://codepen.io/sad-xu/pen/wVdvOO</code></p> <p>带有透明度的色彩叠加</p> <p>原 r1 g1 b1 a1
叠 r2 g2 b2 a2</p> <p>叠加后</p> <p>透明度 <code>1 - (1 - a1) * (1 - a2)</code>
色值 <code>r1 * a1 * (1 - a2) + r2 * a2</code></p> <ol><li><code>r1 * a1</code></li> <li><code>r1 * a1 * (1 - a2) + r2 * a2</code></li></ol> <div class="language- extra-class"><pre class="language-text"><code>a = 1
b = 2
c = 3
d = 4
[a, b] = [b, a]
[c, d] = [d, c]
</code></pre></div><p>​偶然在网上看到了一个有趣的东西</p> <p>【暂无gif,要看的话移步公众号】</p> <p>这个东西有两个特点</p> <ol><li><p>随机</p> <p>起始点位置、分支位置随机，起始方向、分支方向随机</p></li> <li><p>由极简到极繁</p> <p>图中基本单位就只是一条线，之后却衍生出了无数条线</p></li></ol> <p>再看上图</p> <p>明明是随机的产物，却由于整洁的线条产生了一种规整之美</p> <p>极多的线条杂乱交织，看起来却又像城市的规划图一样美观</p> <p>短短几秒由一纸空白变成密密麻麻一片，岂不是象征着人类的城市化建设？</p> <p>以上都是胡扯</p> <p>分析</p> <p>先来分析一下这是如何实现的</p> <p>毫无疑问，是canvas，先是一张空白画布</p> <ol><li>初始有几个随机位置的起点</li> <li>由起点产生一根方向随机的线
（随机指在固定的6个方向里随机）</li> <li>线在前进过程中会随机产生方向随机的分支</li> <li>分支的表现和主分支一样</li> <li>任何线条在互相挡住时停止延伸</li></ol> <p>实现</p> <p>先做点准备工作</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 画布上下文</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#canvas'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
<span class="token comment">// 画布尺寸 不要写死 自适应用</span>
<span class="token keyword">let</span> width<span class="token punctuation">,</span> height
<span class="token comment">// 6个角度 弧度值便于计算  ±30 ±90 ±150</span>
<span class="token keyword">const</span> numAngles <span class="token operator">=</span> <span class="token number">6</span>
<span class="token keyword">let</span> angles <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span>length<span class="token punctuation">:</span> numAngles<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">/</span> numAngles <span class="token operator">*</span> i <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 配置项 控制诸如速度、密度等 先不写</span>
<span class="token keyword">const</span> <span class="token constant">CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>canvas这类的代码一般分两步</p> <p>第一步初始化，第二步循环画图</p> <p>这里也一样，大致如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 为了自适应</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span>
​
<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 初始化</span>
<span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 画图</span>

<span class="token comment">// 没啥可说的，基本操作</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化全屏尺寸</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight
  <span class="token comment">// 初始化背景</span>
  ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rgb(238,238,238)</span><span class="token template-punctuation string">`</span></span>
  ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>animate</p> <p>先写个架子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 具体操作</span>
  <span class="token comment">// 随浏览器刷新频率更新动画</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以把线看成一个类<code>Line</code>，每条直线就是一个实例<code>line</code></p> <p>属性有当前点的坐标，下次更新点的坐标，坐标变化值</p> <p>方法应该有一个更新坐标的方法<code>update</code>，一个画线的方法<code>draw</code></p> <ul><li>如何实现前方出现阻碍就停止延伸？</li></ul> <p>可以在<code>update</code>里判断前方是否有阻碍，返回不同的值</p> <p>若无阻碍，执行<code>draw</code></p> <p>若有，不执行，而且此条线已经没有价值了</p> <ul><li>那如何判断前方是否有阻碍呢？</li></ul> <p>从属性里可以得到下次更新点的坐标</p> <p>只需要检测那个位置对应的颜色代码</p> <p>用<code>getImageData</code>检测一个像素的颜色代码是否和背景色相同即可</p> <ul><li>单个线条在延伸过程中还需要随机分裂出分支</li></ul> <p>即在<code>update</code>里还需要随机产生新实例</p> <p>关于随机的程度，可以在<code>CONFIG</code>里定义</p> <p>为了尽可能解耦类，<code>update</code>需要返回两个状态</p> <p>一是上文的是否有阻碍，返回boolean</p> <p>二是本次更新是否会产生分支，若有则返回当前坐标，无则不反回</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 也可用class</span>
<span class="token keyword">function</span> <span class="token function">Line</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> vx<span class="token punctuation">,</span> vy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 起点</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y
  <span class="token comment">// 终点</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x1 <span class="token operator">=</span> x
  <span class="token keyword">this</span><span class="token punctuation">.</span>y1 <span class="token operator">=</span> y
  <span class="token comment">// 变化值</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>vx <span class="token operator">=</span> vx
  <span class="token keyword">this</span><span class="token punctuation">.</span>vy <span class="token operator">=</span> vy
<span class="token punctuation">}</span>
<span class="token comment">// 为了能通过this访问上下文，减少对外部的依赖</span>
<span class="token class-name">Line</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>ctx <span class="token operator">=</span> ctx
​
<span class="token class-name">Line</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx
  ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">0.8</span>
  ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">&quot;#000&quot;</span>
  ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x1<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y1<span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// { flag: Boolean, branch: {x, y} }</span>
<span class="token class-name">Line</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> updateStatus <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// CONFIG.chanceToSplit</span>
    updateStatus<span class="token punctuation">.</span>branch <span class="token operator">=</span> <span class="token punctuation">{</span>
      x<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
      y<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x1
  <span class="token keyword">this</span><span class="token punctuation">.</span>x1 <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vx <span class="token comment">// * Math.random()</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y1
  <span class="token keyword">this</span><span class="token punctuation">.</span>y1 <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vy <span class="token comment">// * Math.random()</span>
  <span class="token comment">// 如果实际画出来表现不好的话，颜色判定可以稍微宽松一点</span>
  updateStatus<span class="token punctuation">.</span>flag <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x1<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">238</span>
  <span class="token keyword">return</span> updateStatus
<span class="token punctuation">}</span>
</code></pre></div><p>这里自然需要一个全局变量<code>lines</code>来存放所有实例</p> <p>还要一个添加实例进数组方法</p> <p>在创造实例时的<code>vx``vy</code>的大小代表线延伸的速度，可以在<code>CONFIG</code>里定义</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> lines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
​
<span class="token keyword">function</span> <span class="token function">addLine</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> angles<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> angles<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> vx <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token comment">// CONFIG.speed</span>
  <span class="token keyword">let</span> vy <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token comment">// CONFIG.speed</span>
  lines<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Line</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> vx<span class="token punctuation">,</span> vy<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>完善<code>animate</code>方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 每次更新动画，遍历现有所有线</span>
<span class="token comment">// 有分支 - 加线</span>
<span class="token comment">// 可更新 - draw</span>
<span class="token comment">// 不可更新 - 删除线</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> line <span class="token operator">=</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
  <span class="token keyword">let</span> updateStatus <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>updateStatus<span class="token punctuation">.</span>branch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">}</span> <span class="token operator">=</span> updateStatus<span class="token punctuation">.</span>branch
    <span class="token function">addLine</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>updateStatus<span class="token punctuation">.</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    line<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    lines<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    i<span class="token operator">--</span>
    <span class="token keyword">delete</span> line
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最开始的随机的起始点怎么弄？</p> <p>要么在最开始的<code>lines</code>里弄几个实例</p> <p>要么在<code>animate</code>里加个判断，当<code>lines</code>长度小于某个值时，往里加线</p> <p>至此，本文最开始的动图就实现了</p> <p>以上有一些缺点</p> <p>比如随机的方向虽然是6选1，但实际有效的只有4个，因为和当前方向相同或相反都没有意义</p> <p>再比如判断阻挡的方法始终会空1个像素，因为在判断的时候，下一个点还没画，这就导致所有线条交叉的地方都会空1个像素
但我不想做了</p> <p>其实还有一个渐隐的功能没说，因为这涉及到颜色和透明度的堆叠计算，实现起来有时候有点莫名的卡顿，不太完美，以后有机会再说</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>本文算是一次比较失败的尝试，因为我仅仅是看懂了别人的成品</p> <p>我想不出这样有创意的点子是其一</p> <p>无法在其基础上做出更有意思的东西是其二</p> <p>我曾尝试过把直线换成其他有意义的形状比如星星、波浪，但做不到</p> <p>这个东西的特点在一开始就说了</p> <p>不变的东西一直不变</p> <p>变的东西随机着一直在变</p> <p>我做不到有规律的变，顶多通过改变<code>vx``vy</code>做成下面这样</p> <p>究其原因，还是对可视化这方面接触的太少，平时无论是工作还是学习都不会和它有太多交集</p> <p>而且看过一些这方面的代码，发现他们和平时的代码有很大区别，变量多，计算极多，2D的如此，3D的就更别说了，逻辑及其复杂。而且似乎这类代码没有工程化这个概念，都是一个实现一个文件一坨代码，一眼看去很头大。</p> <p>这种东西，还是以后有时间有机会再深入比较好，现在也就随便看看长长见识</p> <p>友情链接：</p> <ol><li><a href="https://codepen.io/sad-xu/pen/wVdvOO" target="_blank" rel="noopener noreferrer">相对完善的代码及预览<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">修改于:</span> <span class="time">10/5/2019, 2:34:34 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/essay/" class="prev router-link-active">技术杂文</a></span> <span class="next"><a href="/essay/纯CSS实现酷炫文字效果.html">纯CSS实现酷炫文字效果</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3b644823.js" defer></script><script src="/assets/js/2.e997199f.js" defer></script><script src="/assets/js/34.89e76bff.js" defer></script>
  </body>
</html>
