(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{225:function(t,v,s){"use strict";s.r(v);var a=s(0),_=Object(a.a)({},(function(){var t=this,v=t.$createElement,s=t._self._c||v;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"highcharts多图联动实现及优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#highcharts多图联动实现及优化"}},[t._v("#")]),t._v(" Highcharts多图联动实现及优化")]),t._v(" "),s("p",[t._v("场景: 当前页面内有若干张图表，所有图表的x轴坐标均一致")]),t._v(" "),s("p",[t._v("需求:")]),t._v(" "),s("ul",[s("li",[t._v("同步缩放 - 当对任一图表进行x轴缩放时，所有图表也会一起缩放")]),t._v(" "),s("li",[t._v("同步鼠标位置 - 鼠标移至某一图中，所有图表的"),s("code",[t._v("准星线")]),t._v("均会随鼠标在图中的位置同步变化")])]),t._v(" "),s("p",[t._v("针对以上需求，有一个官方实例"),s("code",[t._v("https://jshare.com.cn/temp/YOp6D7")])]),t._v(" "),s("ol",[s("li",[t._v("解读示例实现方法")]),t._v(" "),s("li",[t._v("分析示例的潜在问题和具体优化方案")])]),t._v(" "),s("h3",{attrs:{id:"官方示例实现方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官方示例实现方法"}},[t._v("#")]),t._v(" 官方示例实现方法")]),t._v(" "),s("p",[t._v("首先，把所有图表的实例存到一个数组中")]),t._v(" "),s("p",[s("code",[t._v("allCharts = [chart1, chart2, ...]")])]),t._v(" "),s("h4",{attrs:{id:"同步缩放"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同步缩放"}},[t._v("#")]),t._v(" 同步缩放")]),t._v(" "),s("p",[t._v("同步缩放比较简单，就两点")]),t._v(" "),s("ul",[s("li",[t._v("A. 缩放事件 "),s("code",[t._v("xAxis.events.setExtremes")])]),t._v(" "),s("li",[t._v("B. 手动缩放坐标轴 "),s("code",[t._v("chart.xAxis[0].setExtremes(min, max, redraw, animation)")])])]),t._v(" "),s("p",[t._v("在缩放事件中对其他图表设置同样的范围\n用户缩放 --\x3e 触发"),s("code",[t._v("A")]),t._v(" -> 对其余图表调用"),s("code",[t._v("B")]),t._v(" --\x3e 被手动设置的图表均会触发"),s("code",[t._v("A")])]),t._v(" "),s("p",[t._v("以上会导致死循环\n所以要区分用户缩放和"),s("code",[t._v("B")]),t._v("引起的缩放，只有在用户缩放触发的事件中才需要执行"),s("code",[t._v("B")])]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("B")]),t._v("中追加标志")]),t._v(" "),s("p",[s("code",[t._v("chart.xAxis[0].setExtremes(min, max, redraw, animation, { trigger: 'syncExtremes' })")])]),t._v(" "),s("p",[t._v("同时在"),s("code",[t._v("A")]),t._v("的处理函数中增加判断逻辑 "),s("code",[t._v("if (e.trigger === 'syncExtremes')")]),t._v("\n即可实现同步缩放")]),t._v(" "),s("h4",{attrs:{id:"同步鼠标位置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同步鼠标位置"}},[t._v("#")]),t._v(" 同步鼠标位置")]),t._v(" "),s("p",[t._v("添加"),s("code",[t._v("mousemove")]),t._v("事件 --\x3e 得到原生事件的"),s("code",[t._v("e")]),t._v(" --\x3e 由"),s("code",[t._v("e")]),t._v("找到对应图表中的点"),s("code",[t._v("point")]),t._v(" --\x3e 对"),s("code",[t._v("point")]),t._v("设置效果")]),t._v(" "),s("p",[t._v("以下是官方示例的一段代码,关键点有三个")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("event "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" chart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pointer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("normalize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("originalEvent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.转换原生事件")]),t._v("\npoint "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" chart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("series"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("searchPoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.寻找对应点")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("point"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" point"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("highlight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3.设置`point`效果")]),t._v("\n")])])]),s("p",[t._v("在所有图表的外层"),s("code",[t._v("dom")]),t._v("上绑定了事件，触发时,对所有图表执行以上三步操作")]),t._v(" "),s("h3",{attrs:{id:"官方示例潜在问题及优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官方示例潜在问题及优化"}},[t._v("#")]),t._v(" 官方示例潜在问题及优化")]),t._v(" "),s("ol",[s("li",[t._v("定位不准")])]),t._v(" "),s("p",[t._v("若用以上方法实现同步鼠标位置，则每个图表必须"),s("code",[t._v("竖直排列")]),t._v("且"),s("code",[t._v("首尾对齐")])]),t._v(" "),s("p",[t._v("若图表首尾不对齐或宽度又长又短，则会x轴同步不准")]),t._v(" "),s("p",[t._v("若图表横向排列，则不会出现同步效果")]),t._v(" "),s("p",[t._v("这是示例中最大的缺陷")]),t._v(" "),s("p",[t._v("这时由于示例在事件处理中对每张图都执行了以上三步")]),t._v(" "),s("p",[t._v("即所有图表寻找的对应点都是基于触发事件时的鼠标位置的X坐标，这是一种"),s("code",[t._v("视觉角度")])]),t._v(" "),s("p",[t._v("以鼠标位置为基准，画一条竖线")]),t._v(" "),s("p",[t._v("示例只会保证每个图表的准星线都会和竖线重合，导致了以上的问题")]),t._v(" "),s("p",[t._v("解决方法是需要从"),s("code",[t._v("数据角度")]),t._v("实现同步")]),t._v(" "),s("ul",[s("li",[t._v("A. 给每个图表绑定"),s("code",[t._v("mousemove")]),t._v("事件")]),t._v(" "),s("li",[t._v("B. 通过"),s("code",[t._v("chart.pointer.normalize")]),t._v("和"),s("code",[t._v("chart.series[0].searchPoint")]),t._v("找到当前触发图表的"),s("code",[t._v("point")])]),t._v(" "),s("li",[t._v("C. 由"),s("code",[t._v("point")]),t._v("得到x轴实际坐标"),s("code",[t._v("x")]),t._v("，遍历其余图表实例在"),s("code",[t._v("chart.series[0].data")]),t._v("中根据"),s("code",[t._v("x")]),t._v("找到"),s("code",[t._v("point")]),t._v("，设置"),s("code",[t._v("point")]),t._v("效果")])]),t._v(" "),s("p",[t._v("上述方法是靠实际的x轴坐标点实现的定位，可以保证同步时每个图都是同一个坐标\n比起示例中每个图都要找点和转换，我的方法只要找一次，遍历只需要"),s("code",[t._v("find")]),t._v("即可，节省了大量开销")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("修改了原型方法")])]),t._v(" "),s("p",[t._v("即同步鼠标位置的第三步")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("Highcharts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Point")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("highlight")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onMouseOver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 显示鼠标激活标识")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("修改原型方法会对该项目的所有图表产生影响，不应该随便改动\n可将第三步改为")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("point"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onMouseOver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("性能优化")])]),t._v(" "),s("p",[t._v("实例中没有进行任何优化，但多图联动不可避免会出现大量数据的情况，而鼠标事件不可避免的频繁触发也容易导致性能问题")]),t._v(" "),s("p",[t._v("下面将从两个角度谈一谈性能优化")]),t._v(" "),s("ul",[s("li",[t._v("配置")])]),t._v(" "),s("p",[t._v("可以通过调整highcharts配置进行优化")]),t._v(" "),s("ol",[s("li",[s("p",[s("code",[t._v("chart.animation")]),t._v("\n禁用动画效果，减少在渲染上花费的时间")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("boost.useGPUTranslations")]),t._v("\n启用GPU渲染，增加渲染速度")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("dataGrouping")]),t._v("\n当数据量较大时，会进行模糊处理，即相邻数据会合并\n虽然会提高性能，但显示精度会明显下降，酌情使用")])])]),t._v(" "),s("ul",[s("li",[t._v("js")])]),t._v(" "),s("p",[t._v("同样的功能，换一种写法，性能可能会有质的提高")]),t._v(" "),s("p",[t._v("针对js的优化首先是优化逻辑")]),t._v(" "),s("p",[t._v("但在大量数据和图表的情况下，再怎么优化都有很大的计算量")]),t._v(" "),s("p",[t._v("所以就需要欺骗一下人眼了")]),t._v(" "),s("p",[t._v("将大块操作分割成n个小操作，即将大卡顿转化成n个小卡顿")]),t._v(" "),s("p",[t._v("只要单个卡顿耗时小于16ms，对人来说就等于没有卡顿")]),t._v(" "),s("p",[t._v("最开始把所有图表实例存在了一个数组里")]),t._v(" "),s("p",[t._v("之后的许多操作需要遍历数组")]),t._v(" "),s("p",[t._v("这里有两个影响性能的点：数组长度，单次执行时间")]),t._v(" "),s("p",[t._v("假设单次执行耗时为"),s("code",[t._v("a")]),t._v("，数组长度为"),s("code",[t._v("b")]),t._v("，那么每次循环耗时则为"),s("code",[t._v("a*b")])]),t._v(" "),s("p",[t._v("如果按照一般操作，遍历数组的过程中页面是不会进行渲染的")]),t._v(" "),s("p",[t._v("即每次循环会造成"),s("code",[t._v("a*b")]),t._v("的卡顿")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("setTimeout 0")])])]),t._v(" "),s("p",[t._v("这是"),s("code",[t._v("ECharts")]),t._v("开发者袁源在第三届VueConf中分享的小技巧\n通过"),s("code",[t._v("setTimeout")]),t._v("0s让浏览器喘口气\n将关键性的操作用"),s("code",[t._v("setTimeout")]),t._v("包起来")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("异步")])]),t._v(" "),s("p",[t._v("可以把遍历里的操作转成异步，避免产生阻塞")]),t._v(" "),s("p",[t._v("实际开发中往往是异步和"),s("code",[t._v("setTimeout")]),t._v("同时使用效果最佳")]),t._v(" "),s("p",[t._v("唯一的副作用是当图表过多时同步效果会有零点几秒的先后差别，这也是没办法的事")]),t._v(" "),s("ul",[s("li",[t._v("设计")])]),t._v(" "),s("p",[t._v("当用尽手段，效果还是不理想时,就要考虑一下需求的合理性了")]),t._v(" "),s("p",[t._v("是否有必要展示这么多数据,大量的图表是否一定要一起展示，是否可以换一种展现方式")]),t._v(" "),s("p",[t._v("前端在实现一个需求的时候往往要一人分饰三角")]),t._v(" "),s("p",[t._v("开发：如何实现需求 --\x3e 如何更好的实现需求")]),t._v(" "),s("p",[t._v("产品：为什么这样设计 --\x3e 有更好的设计方案吗")]),t._v(" "),s("p",[t._v("用户：使用是否顺心 --\x3e 交互细节是否到位")]),t._v(" "),s("p",[t._v("友情链接：")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://jshare.com.cn/temp/YOp6D7",target:"_blank",rel:"noopener noreferrer"}},[t._v("多图联动官方示例"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.yuque.com/vueconf/2019/blfy0p",target:"_blank",rel:"noopener noreferrer"}},[t._v("袁源 - Vue开发ECharts踩坑指南演讲视频"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);v.default=_.exports}}]);